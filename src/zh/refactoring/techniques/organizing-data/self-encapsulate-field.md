---
title: 自封装字段
date: 2024-03-01
order: 1
category:
  - 重构
---

> 自封装不同于普通的 [Encapsulate Field](./encapsulate-field.md)：这里给出的重构技术是在私有字段上执行的。

## 问题

您可以直接访问类中的私有字段。

```java
class Person {
  public String name;
}
```

## 解决方法

为该字段创建一个 `getter` 和 `setter`，并仅使用它们来访问该字段。

```java
class Person {
  private String name;

  public String getName() {
    return name;
  }
  public void setName(String arg) {
    name = arg;
  }
}
```

## 为什么要重构？

面向对象编程的支柱之一是封装，即隐藏对象数据的能力。否则，所有对象都将是公共的，其他对象可以在没有任何制衡的情况下获取和修改您对象的数据！数据与此数据关联的行为分离，程序部分的模块化受到损害，维护变得复杂。

## 好处

* 如果一个组件的数据和行为密切相关，并且在代码中位于同一位置，那么您维护和开发该组件就会容易得多。

* 您还可以执行与访问对象字段相关的复杂操作。

> 在某些情况下，出于性能方面的考虑，封装是不明智的。这些情况很少见，但一旦发生，这种情况就非常重要。
> 假设您有一个图形编辑器，其中包含具有 x 和 y 坐标的对象。这些字段将来不太可能改变。更重要的是，该程序涉及大量存在这些字段的不同对象。因此，直接访问坐标字段可以节省大量的 CPU 周期，否则这些周期将被调用访问方法占用。
> 作为这种不寻常情况的示例，有 Java 中的 [Point](http://docs.oracle.com/javase/7/docs/api/java/awt/Point.html) 类。此类的所有字段都是公共的。

## 如何重构？

1. 为该字段创建一个 `getter` 和 `setter`。
2. 查找该字段的所有调用。用 `getter` 代替接收字段值，用 `setter` 代替设置新字段值。
3. 替换所有字段调用后，将字段设为私有。

> 封装字段只是将数据和涉及该数据的行为更紧密地结合在一起的第一步。在为访问字段创建简单方法后，您应该重新检查调用这些方法的地方。这些区域中的代码很可能在访问方法中看起来更合适。
