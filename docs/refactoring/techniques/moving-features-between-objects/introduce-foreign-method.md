---
title: 引入外部方法
date: 2024-03-01
order: 7
category:
  - 重构
---

## 问题

实用程序类不包含您需要的方法，您不能将该方法添加到类中。

```java
class Report {
  // ...
  void sendReport() {
    Date nextDay = new Date(previousEnd.getYear(),
      previousEnd.getMonth(), previousEnd.getDate() + 1);
    // ...
  }
}
```

## 解决方法

将方法添加到客户端类并将实用程序类的对象作为参数传递给它。

```java
class Report {
  // ...
  void sendReport() {
    Date newStart = nextDay(previousEnd);
    // ...
  }
  private static Date nextDay(Date arg) {
    return new Date(arg.getYear(), arg.getMonth(), arg.getDate() + 1);
  }
}
```

## 为什么要重构？

您有使用某个类的数据和方法的代码。您意识到代码在类的新方法中看起来和工作得更好。但是您不能将该方法添加到该类中，因为例如该类位于第三方库中。

当您要移至该方法的代码在程序的不同位置重复多次时，这种重构会带来很大的回报。

由于您将实用程序类的对象传递给新方法的参数，因此您可以访问它的所有字段。在方法内部，您几乎可以做任何您想做的事情，就好像该方法是实用程序类的一部分一样。

## 好处

删除代码重复。如果你的代码在几个地方重复，你可以用一个方法调用来替换这些代码片段。即使考虑到外部方法位于次优位置，这也比重复要好。

## 缺点

在您之后维护代码的人并不总是清楚在客户端类中使用实用程序类方法的原因。如果该方法可以在其他类中使用，您可以通过为实用程序类创建一个包装器并将该方法放在那里而受益。当有多个这样的实用方法时，这也是有益的。 [Introduce Local Extension](./introduce-local-extension.md) 可以帮助解决这个问题。

## 如何重构？

1. 在客户端类中创建一个新方法。
2. 在此方法中，创建一个参数，实用程序类的对象将传递到该参数。如果这个对象可以从客户类中获得，你就不必创建这样的参数。
3. 将相关的代码片段提取到这个方法中，并用方法调用替换它们。
4. 请务必在方法的注释中留下 Foreign 方法标记，并建议将此方法放在实用程序类中（如果以后可能的话）。这将使将来维护软件的人员更容易理解为什么此方法位于此特定类中。