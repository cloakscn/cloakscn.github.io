---
title: 提取类
date: 2024-03-01
order: 3
category:
  - 重构
---

## 问题

当一个类做两个类的工作时，就会产生尴尬。

![Extract Class - Before](https://refactoringguru.cn/images/refactoring/diagrams/Extract%20Class%20-%20Before.png =x150)

## 解决方法

相反，创建一个新类并将负责相关功能的字段和方法放入其中。

![Extract Class - After](https://refactoringguru.cn/images/refactoring/diagrams/Extract%20Class%20-%20After.png =x150)

## 为什么要重构？

类总是一开始就清晰易懂。他们做自己的工作，只管自己的事，不插手其他类的工作。但是随着程序的扩展，添加了一个方法，然后添加了一个字段……最终，一些类正在执行比以往想象的更多的职责。

## 有什么好处？

* 这种重构方法将有助于保持对单一职责原则的遵守。您的类代码将更加明显和易于理解。
* 单一职责类更可靠，更能容忍变化。例如，假设您有一个类负责十个不同的事情。当您更改此类以使其更好地用于一件事时，您冒着为其他九件事而破坏它的风险。

## 缺点

如果您使用这种重构技术“过度”，您将不得不求助于 [Inline Class](inline-class.md)。

## 如何重构？

在开始之前，确定您希望如何准确地划分类的职责。

1. 创建一个新类以包含相关功能。
2. 在旧类和新类之间建立关系。理想情况下，这种关系是单向的；这允许毫无问题地重用第二类。尽管如此，如果您认为双向关系是必要的，则始终可以建立这种关系。
3. 对您决定移动到新类的每个字段和方法使用 [Move Field](move-field.md) 和 [Move Method](move-method.md)。对于方法，从私有的开始，以减少犯大量错误的风险。尝试一次只移动一点点，并在每次移动后测试结果，以避免在最后进行大量的错误修复。

    完成移动后，再看一看生成的类。为提高清晰度，可能会重命名具有更改职责的旧类。再次检查是否可以消除双向类关系（如果存在）。

4. 还要考虑从外部访问新类的可访问性。您可以通过将其设为私有并通过旧类的字段对其进行管理来完全向客户端隐藏该类。或者，您可以通过允许客户端直接更改值来将其设为公共。您在这里的决定取决于当对新类中的值进行意外的直接更改时，旧类的行为的安全性。