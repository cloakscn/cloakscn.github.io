# 层次式架构设计理论与实践

## 表现层框架设计

### MVC（Model-View-Controller）模式

MVC 是一种软件设计模式。MVC 把一个应用的输入、处理、输出流程按照视图、控制、模型的方式进行分离，形成了控制器、模型、视图 3 个核心模块。其中：

* 控制器（Controller）：接受用户的输入，并调用模型和视图去完成用户的需求；
* 模型（Model）：应用程序的主体部分，表示业务数据和业务逻辑；
* 视图（View）：用户看到并与之交流的界面。

![MVC 三者协作关系图](image-4.png)

使用 MVC 来设计表现层可以有如下优点：

* 允许多种用户界面扩展；
* 易于维护；
* 易于构建功能强大的用户界面；
* 增加应用的可拓展性、强壮性、灵活性。

### MVP（Model-View-Presenter）模式

在 MVP 模式中 Model 提供数据，View 负责显示，`Controller/Presenter` 负责逻辑的处理。MVP 不仅仅避免了 View 和 Model 之间的耦合，还进一步降低了 Presenter 对 View 的依赖。

![MVP 设计模式](image-6.png)

使用 MVP 模式来设计表现层，可以有以下的优点：
* 模型与视图完全分离，可以修改视图而不影响模型。
* 所有的交互都发生在一个地方—Presenter 内部，因此可以更高效地使用模型。
* 可以将一个 Presenter 用于多个视图，而不需要改变 Presenter 的逻辑。因为视图的变化总是比模型的变化频繁。
* 如果把逻辑放在 Presenter 中，就可以脱离用户接口来测试这些逻辑（单元测试）。

### MVVM 模式

MVVM 和 MVC、MVP 类似，主要目的都是为了实现视图和模型的分离。不同的是 MVVM 中，View 与 Model 的交互通过 ViewModel 来实现，也就是 View 和 Model 不能直接通信，两者的通信只能通过 ViewModel 来实现。ViewModel 是 MVVM 的核心，通过 DataBinding 实现 View 与 Model 之间的双向绑定，其内容包括数据状态处理、数据绑定及数据转换。

![MVVM 流程设计模式](image-7.png)

## 中间层框架设计

1. 业务逻辑层组件设计

    业务逻辑层组件分为接口和实现类两个部分。接口用于定义业务逻辑组件，定义业务逻辑组件必须实现的方法是整个系统运行的核心。通常按模块来设计业务逻辑组件，每个模块设计一个业务逻辑组件，并且每个业务逻辑组件以多个数据访问对象（Data Access Object，DAO）组件作为基础，从而实现对外提供系统的业务逻辑服务。

2. 业务逻辑层工作流设计

    工作流管理联盟（Workflow Management Coalition，WFMC）将工作流定义为：业务流程的全部或部分自动化，在此过程中，文档、信息或任务按照一定的过程规则流转，实现组织成员间的协调工作以达到业务的整体目标。

    ![工作流参考模型](image-8.png)

3. 业务逻辑层实体设计

    逻辑层实体提供对业务数据及相关功能（在某些设计中）的状态编程访问。业务逻辑层实体可以使用具有复杂架构的数据来构建，这种数据通常来自数据库中的多个相关表。业务逻辑层实体数据可以作为业务过程的部分 I/O 参数传递。业务逻辑层实体是可序列化的，以保持它们的当前状态。

4. 业务逻辑层框架

    业务逻辑框架位于系统架构的中间层，是实现系统功能的核心组件。采用容器的形式，便于系统功能的开发、代码重用和管理。在业务容器中，业务逻辑是按照 Domain Model-Service-Control 思想来实现的。其中：

 * Domain Model 是仅仅包含业务相关的属性的领域层业务对象；
 * Service 是业务过程实现的组成部分，是应用程序的不同功能单元，通过在这些服务之间定义良好的接口和契约联系起来；
 * Control 服务控制器，是服务之间的纽带，不同服务之间的切换就是通过它来实现的。

## 数据访问层设计