---
date: 2024-11-25
authors:
  - cloaks
categories:
  - 读书笔记
# tags:
#   - 翻译
comments: true
# draft: true
description: |
    通过使用简单的 Golang 代码逐步构建自己的数据库，从下到上了解数据库。

    1. 从 B+树开始，B+树是用于查询和操作数据的数据结构。
    2. 使其持久，这就是数据库与文件的不同之处。
    3. 在写时复制 B+树 KV 之上具有并发事务的关系型数据库。
    4. 类似SQL的查询语言，点睛之笔。
---


# 从头开始构件你自己的数据库

数据库有三种重要的概念，分别是持久、索引、并发。

1. 持久：如何避免丢失或损坏数据。从崩溃中恢复；
2. 索引：高效的查询和处理数据；
3. 并发：如何用事物处理多个客户端的请求。

<!-- more -->

## 持久

我们为什么要使用数据库，不能直接把数据写到文件中吗？显然是可以的，大多数情况下可以直接把数据写道文件中，但是这种方式在某些极端情况下（比如在我的博客中）有问题。

假设你写入文件的一个操作被异常中断，可以是断电、系统崩溃重启诸如此类，你觉得写入的内容正常保存了吗？某个社畜可能因为 word 没有定期保存正在自闭，但是我要和你说的是，即使你保存了文件中的内容也会丢失。

文件可能保存了一半，也可能停留在系统内存页中没来的及刷盘，所以我们需要使用数据库，持久化可以解决这个问题。

## 索引

数据库查询有两种不同的类型：分析性（OLAP）和事务性（OLTP）。

* 分析性查询是对大量数据处理的典型方式：分组、聚合、连接等操作。
* 相反，事务型数据针对的数据量就少很多了，只有一千万条左右，通过对这些数据建立索引达到快速查询的目的。

如果我们忽略了数据持久化的需要，仅保存数据在内存中，那么我们想要快速的查询数据只需要一个合适的数据结构了。通过数据结构对数据建立索引并把数据持久化到硬盘中，我们可以管理比内存大很多的数据。能在内存中解决的问题都不叫问题。常用的索引数据结构包括：B-Trees 和 LSM-Trees。   

## 并发                                     

现代应用程序并非只是按顺序执行所有操作，数据库也是如此。并发有不同的级别：

* 读取器之间的并发；
* 读取器和写入器之间的并发，写入器是否需要要数据库独占访问权限？

甚至基于文件的 SQLite 也支持一定程序的并发性。但在进程内实现并发更容易，这就是为什么大多数数据库系统只能通过”服务器“访问。随着并发性的增加，应用程序通常需要以原子方式执行操作，例如读取-修改-写入操作。这为数据库添加了一个新的概念：事务。